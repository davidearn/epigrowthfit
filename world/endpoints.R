l <- list(
  RUS = list( # Russia
    c("2020-03-05", "2020-05-10"),
    c("2020-09-22", "2020-10-10"),
    c("2020-10-11", "2020-12-10")
  ),
  DEU = list( # Germany
    c("2020-02-25", "2020-04-05"),
    c("2020-07-10", "2020-08-23"),
    c("2020-10-01", "2020-11-10")
  ),
  FRA = list( # France
    c("2020-02-25", "2020-04-05"),
    c("2020-07-01", "2020-09-27"),
    c("2020-10-01", "2020-11-10"),
    c("2020-11-28", "2021-01-01")
  ),
  GBR = list( # United Kingdom
    c("2020-02-20", "2020-04-10"),
    c("2020-07-05", "2020-08-28"),
    c("2020-08-31", "2020-10-25"),
    c("2020-12-05", "2021-01-10")
  ),
  ITA = list( # Italy
    c("2020-02-23", "2020-03-25"),
    c("2020-08-12", "2020-09-05"),
    c("2020-09-28", "2020-11-15")
  ),
  ESP = list( # Spain
    c("2020-02-25", "2020-04-01"),
    c("2020-06-26", "2020-08-10"),
    c("2020-10-10", "2020-11-07"),
    c("2020-12-27", "2021-01-25")
  ),
  UKR = list( # Ukraine
    c("2020-03-15", "2020-04-28"),
    c("2020-05-24", "2020-06-29"),
    c("2020-07-15", "2020-08-24"),
    c("2020-08-25", "2020-12-01"),
    c("2021-02-10", "2021-03-25")
  ),
  POL = list( # Poland
    c("2020-03-01", "2020-04-10"),
    c("2020-07-13", "2020-08-13"),
    c("2020-09-06", "2020-11-10"),
    c("2021-02-10", "2021-03-25")
  ),
  ROU = list( # Romania
    c("2020-03-05", "2020-04-13"),
    c("2020-06-05", "2020-06-25"),
    c("2020-07-01", "2020-08-01"),
    c("2020-09-15", "2020-11-13"),
    c("2021-02-15", "2021-03-25")
  ),
  NLD = list( # Netherlands
    c("2020-02-25", "2020-04-01"),
    c("2020-07-06", "2020-08-15"),
    c("2020-08-28", "2020-11-01"),
    c("2020-11-30", "2020-12-23")
  ),
  BEL = list( # Belgium
    c("2020-03-01", "2020-04-06"),
    c("2020-07-01", "2020-08-12"),
    c("2020-09-01", "2020-09-28"),
    c("2020-09-29", "2020-11-01")
  ),
  GRC = list( # Greece
    c("2020-02-25", "2020-04-03"),
    c("2020-07-20", "2020-08-18"),
    c("2020-10-10", "2020-11-15"),
    c("2021-01-18", "2021-02-20")
  ),
  CZE = list( # Czechia
    c("2020-03-01", "2020-04-03"),
    c("2020-08-25", "2020-09-25"),
    c("2020-09-28", "2020-10-30"),
    c("2020-12-01", "2021-01-10")
  ),
  SWE = list( # Sweden
    c("2020-02-25", "2020-03-15"),
    c("2020-03-16", "2020-04-12"),
    c("2020-05-25", "2020-06-20"),
    c("2020-08-31", "2020-10-15"),
    c("2020-10-16", "2020-11-15"),
    c("2020-11-16", "2021-01-08"),
    c("2021-02-01", "2021-03-25")
  ),
  PRT = list( # Portugal
    c("2020-03-01", "2020-04-03"),
    c("2020-05-05", "2020-06-12"),
    c("2020-08-20", "2020-09-20"),
    c("2020-10-01", "2020-11-19"),
    c("2020-12-24", "2021-01-30")
  ),
  HUN = list( # Hungary
    c("2020-03-01", "2020-04-15"),
    c("2020-06-15", "2020-08-18"),
    c("2020-08-20", "2020-09-22"),
    c("2020-10-12", "2020-11-18"),
    c("2021-02-15", "2021-03-25")
  ),
  BLR = list( # Belarus
    c("2020-04-01", "2020-05-01"),
    c("2020-08-13", "2020-08-28"),
    c("2020-09-15", "2020-11-01")
  ),
  AUT = list( # Austria
    c("2020-02-20", "2020-03-28"),
    c("2020-06-15", "2020-07-20"),
    c("2020-08-01", "2020-08-23"),
    c("2020-09-01", "2020-09-23"),
    c("2020-10-12", "2020-11-14"),
    c("2021-02-10", "2021-03-25")
  ),
  CHE = list( # Switzerland
    c("2020-02-20", "2020-03-28"),
    c("2020-06-15", "2020-07-10"),
    c("2020-07-12", "2020-09-18"),
    c("2020-09-25", "2020-11-06"),
    c("2021-02-20", "2021-03-25")
  ),
  BGR = list( # Bulgaria
    c("2020-03-01", "2020-04-01"),
    c("2020-04-10", "2020-04-28"),
    c("2020-05-25", "2020-06-15"),
    c("2020-06-16", "2020-07-23"),
    c("2020-09-20", "2020-11-15"),
    c("2021-01-17", "2021-03-25")
  ),
  SRB = list( # Serbia
    c("2020-03-10", "2020-04-17"),
    c("2020-06-15", "2020-07-10"),
    c("2020-10-15", "2020-12-01"),
    c("2021-02-13", "2021-03-05")
  ),
  DNK = list( # Denmark
    c("2020-03-01", "2020-04-05"),
    c("2020-07-07", "2020-08-15"),
    c("2020-08-25", "2020-09-27"),
    c("2020-10-17", "2020-11-07"),
    c("2020-11-27", "2020-12-20"),
    c("2021-02-10", "2021-03-25")
  ),
  FIN = list( # Finland
    c("2020-03-01", "2020-04-10"),
    c("2020-07-10", "2020-10-18"),
    c("2021-01-12", "2021-02-05")
  ),
  SVK = list( # Slovakia
    c("2020-03-01", "2020-04-01"),
    c("2020-06-01", "2020-07-05"),
    c("2020-07-08", "2020-09-12"),
    c("2020-09-15", "2020-11-01")
  ),
  NOR = list( # Norway
    c("2020-02-25", "2020-03-30"),
    c("2020-07-16", "2020-08-13"),
    c("2020-08-25", "2020-09-11"),
    c("2020-10-18", "2020-11-12"),
    c("2021-02-20", "2021-03-25")
  ),
  IRL = list( # Ireland
    c("2020-03-01", "2020-04-15"),
    c("2020-07-01", "2020-10-20"),
    c("2020-12-10", "2021-01-01")
  ),
  HRV = list( # Croatia
    c("2020-03-05", "2020-04-02"),
    c("2020-06-08", "2020-07-05"),
    c("2020-08-03", "2020-08-30"),
    c("2020-10-01", "2020-10-30"),
    c("2020-11-01", "2020-12-12"),
    c("2021-02-12", "2021-03-15")
  ),
  BIH = list( # Bosnia and Herzegovina
    c("2020-03-01", "2020-04-05"),
    c("2020-05-25", "2020-07-15"),
    c("2020-10-01", "2020-11-02"),
    c("2021-02-10", "2021-03-25")
  ),
  ALB = list( # Albania
    c("2020-03-05", "2020-04-05"),
    c("2020-05-20", "2020-06-15"),
    c("2020-06-16", "2020-08-25"),
    c("2020-10-01", "2020-11-20"),
    c("2020-12-25", "2021-02-12")
  ),
  LTU = list( # Lithuania
    c("2020-03-10", "2020-04-05"),
    c("2020-06-20", "2020-08-20"),
    c("2020-09-01", "2020-10-01"),
    c("2020-10-05", "2020-11-08"),
    c("2020-11-10", "2021-01-02")
  ),
  # MDA = list( # Moldova
  #   c("2020-03-01", "2020-04-10"),
  #   c("2020-04-15", "2020-12-10"),
  #   c("2021-01-15", "2021-03-05")
  # ),
  SVN = list( # Slovenia
    c("2020-03-01", "2020-03-28"),
    c("2020-06-01", "2020-07-05"),
    c("2020-08-01", "2020-09-30"),
    c("2020-10-01", "2020-11-01")
  ),
  LVA = list( # Latvia
    c("2020-03-01", "2020-04-01"),
    c("2020-09-15", "2020-10-15")
  ),
  EST = list( # Estonia
    c("2020-02-25", "2020-04-05"),
    c("2020-07-10", "2020-10-02"),
    c("2020-10-12", "2020-11-15"),
    c("2020-11-16", "2020-12-25"),
    c("2021-02-01", "2021-03-12")
  ),
  LUX = list( # Luxembourg
    c("2020-03-01", "2020-03-30"),
    c("2020-06-18", "2020-07-25"),
    c("2020-10-12", "2020-11-05")
  ),
  MLT = list( # Malta
    c("2020-03-01", "2020-04-03"),
    c("2020-07-15", "2020-08-20"),
    c("2020-09-25", "2020-10-22"),
    c("2020-12-22", "2021-01-12"),
    c("2021-02-05", "2021-03-12")
  ),
  ISL = list( # Iceland
    c("2020-02-25", "2020-03-30"),
    c("2020-07-15", "2020-08-10"),
    c("2020-09-08", "2020-10-10")
  ),
  AND = list( # Andorra
    c("2020-03-01", "2020-04-01"),
    c("2020-07-15", "2020-10-18"),
    c("2020-12-18", "2021-01-18")
  ),
  MCO = list( # Monaco
    c("2020-02-25", "2020-04-10"),
    c("2020-11-20", "2021-01-28")
  ),
  LIE = list( # Liechtenstein
    c("2020-09-15", "2020-11-15")
  ),
  SMR = list( # San Marino
    c("2020-02-25", "2020-04-15"),
    c("2020-09-20", "2020-11-18")
  ),
  USA = list( # United States
    c("2020-03-01", "2020-04-04"),
    c("2020-06-10", "2020-07-15"),
    c("2020-10-15", "2020-11-20")
  ),
  MEX = list( # Mexico
    c("2020-03-10", "2020-04-10"),
    c("2020-11-15", "2020-12-01"),
    c("2021-01-01", "2021-01-23")
  ),
  CAN = list( # Canada
    c("2020-03-01", "2020-04-10"),
    c("2020-08-15", "2020-10-07"),
    c("2020-10-08", "2020-12-10")
  ),
  GTM = list( # Guatemala
    c("2020-03-10", "2020-05-30"),
    c("2020-06-01", "2020-07-10")
  ),
  CUB = list( # Cuba
    c("2020-03-10", "2020-04-15"),
    c("2020-07-20", "2020-08-15"),
    c("2020-10-10", "2020-11-01"),
    c("2020-11-20", "2021-02-05")
  ),
  HTI = list( # Haiti
    c("2020-04-25", "2020-06-10"),
    c("2020-11-25", "2021-01-25")
  ),
  DOM = list( # Dominican Republic
    c("2020-03-01", "2020-04-15"),
    c("2020-06-01", "2020-07-30"),
    c("2020-11-01", "2021-01-20")
  ),
  HND = list( # Honduras
    c("2020-03-05", "2020-07-05")
  ),
  NIC = list( # Nicaragua
    c("2020-04-20", "2020-07-01")
  ),
  SLV = list( # El Salvador
    c("2020-03-15", "2020-05-25"),
    c("2020-06-05", "2020-07-10"),
    c("2020-09-15", "2020-12-01")
  ),
  CRI = list( # Costa Rica
    c("2020-03-01", "2020-04-01"),
    c("2020-05-20", "2020-07-20"),
    c("2020-07-21", "2020-09-18")
  ),
  PAN = list( # Panama
    c("2020-03-01", "2020-04-15"),
    c("2020-05-15", "2020-06-10"),
    c("2020-11-01", "2021-01-08")
  ),
  JAM = list( # Jamaica
    c("2020-03-01", "2020-05-01"),
    c("2020-07-15", "2020-09-20"),
    c("2021-01-05", "2021-03-25")
  ),
  BLZ = list( # Belize
    c("2020-07-15", "2020-09-10"),
    c("2020-11-17", "2020-12-14")
  ),
  BHS = list( # Bahamas
    c("2020-03-10", "2020-04-15"),
    c("2020-07-01", "2020-08-05"),
    c("2020-08-06", "2020-10-15")
  ),
  BRB = list( # Barbados
    c("2020-12-01", "2021-02-25")
  ),
  BRA = list( # Brazil
    c("2020-02-25", "2020-04-15"),
    c("2020-11-01", "2020-12-05"),
    c("2021-02-12", "2021-03-25")
  ),
  COL = list( # Colombia
    c("2020-03-01", "2020-04-10"),
    c("2020-12-10", "2021-01-20"),
    c("2021-03-07", "2021-03-25")
  ),
  ARG = list( # Argentina
    c("2020-03-01", "2020-04-10"),
    c("2020-05-01", "2020-07-01"),
    c("2020-09-01", "2020-10-25"),
    c("2020-12-18", "2021-01-10")
  ),
  PER = list( # Peru
    c("2020-03-01", "2020-05-10"),
    c("2020-07-15", "2020-08-20"),
    c("2020-12-25", "2021-02-05")
  ),
  VEN = list( # Venezuela
    c("2020-05-01", "2020-06-10"),
    c("2020-06-27", "2020-08-18"),
    c("2021-01-01", "2021-01-21"),
    c("2021-03-01", "2021-03-25")
  ),
  CHL = list( # Chile
    c("2020-03-01", "2020-04-10"),
    c("2020-04-15", "2020-06-10"),
    c("2020-12-10", "2021-01-20"),
    c("2021-02-15", "2021-03-25")
  ),
  ECU = list( # Ecuador
    c("2020-03-01", "2020-04-10"),
    c("2020-05-25", "2020-07-20"),
    c("2020-12-20", "2021-02-01")
  ),
  BOL = list( # Bolivia
    c("2020-03-05", "2020-06-01"),
    c("2020-12-01", "2021-01-20")
  ),
  PRY = list( # Paraguay
    c("2020-06-01", "2020-09-10"),
    c("2020-11-01", "2020-12-10"),
    c("2021-02-01", "2021-03-25")
  ),
  URY = list( # Urugruay
    c("2020-06-08", "2020-07-28"),
    c("2020-09-15", "2020-11-15"),
    c("2020-11-18", "2020-12-28"),
    c("2021-03-01", "2021-03-25")
  ),
  GUY = list( # Guyana
    c("2020-07-10", "2020-09-20"),
    c("2020-12-28", "2021-02-01"),
    c("2021-02-25", "2021-03-25")
  ),
  SUR = list( # Suriname
    c("2020-06-01", "2020-08-18"),
    c("2020-11-25", "2021-01-15")
  ),
  AUS = list( # Australia
    c("2020-03-01", "2020-03-30"),
    c("2020-06-12", "2020-07-20"),
    c("2020-12-08", "2020-12-31"),
    c("2021-02-18", "2021-03-15")
  ),
  PNG = list( # Papua New Guinea
    c("2020-07-12", "2020-08-18"),
    c("2021-01-15", "2021-03-25")
  ),
  NZL = list( # New Zealand
    c("2020-03-10", "2020-04-05"),
    c("2020-08-01", "2020-08-25")
  ),
  CHN = list( # China
    c("2020-01-15", "2020-02-07"),
    c("2020-03-10", "2020-04-01"),
    c("2020-07-03", "2020-07-30"),
    c("2020-11-15", "2020-12-01"),
    c("2021-01-04", "2021-01-22")
  ),
  IND = list( # India
    c("2020-03-01", "2020-04-15"),
    c("2020-05-05", "2020-08-01"),
    c("2020-08-15", "2020-09-15"),
    c("2021-03-05", "2021-04-01")
  ),
  IDN = list( # Indonesia
    c("2020-03-01", "2020-04-15"),
    c("2020-05-05", "2020-07-10"),
    c("2020-08-18", "2020-09-12"),
    c("2020-11-01", "2020-12-03"),
    c("2020-12-28", "2021-01-28")
  ),
  PAK = list( # Pakistan
    c("2020-03-01", "2020-03-28"),
    c("2020-04-01", "2020-06-15"),
    c("2020-10-20", "2020-11-25"),
    c("2021-03-01", "2021-04-01")
  ),
  BGD = list( # Bangladesh
    c("2020-03-28", "2020-04-22"),
    c("2020-04-25", "2020-06-20"),
    c("2020-11-08", "2020-11-28"),
    c("2021-03-01", "2021-04-01")
  ),
  JPN = list( # Japan
    c("2020-01-25", "2020-03-15"),
    c("2020-03-20", "2020-04-13"),
    c("2020-06-20", "2020-08-05"),
    c("2020-10-28", "2020-11-25"),
    c("2020-12-18", "2021-01-15"),
    c("2021-03-12", "2021-04-01")
  ),
  PHL = list( # Philippines
    c("2020-03-01", "2020-04-01"),
    c("2020-05-20", "2020-08-15"),
    c("2021-02-28", "2021-04-01")
  ),
  VNM = list( # Vietnam
    c("2020-03-01", "2020-04-01"),
    c("2020-07-15", "2020-08-10"),
    c("2021-01-15", "2021-02-15")
  ),
  IRN = list( # Iran
    c("2020-02-15", "2020-03-12"),
    c("2020-03-17", "2020-04-01"),
    c("2020-05-01", "2020-05-22"),
    c("2020-09-01", "2020-09-25"),
    c("2020-10-15", "2020-11-20"),
    c("2021-01-20", "2021-02-23")
  ),
  TUR = list( # Turkey
    c("2020-03-10", "2020-04-01"),
    c("2020-06-01", "2020-06-22"),
    c("2020-07-20", "2020-09-10"),
    c("2020-10-01", "2020-11-01"),
    c("2020-11-10", "2020-11-24"),
    c("2021-02-20", "2021-03-12"),
    c("2021-03-13", "2021-04-01")
  ),
  THA = list( # Thailand
    c("2020-03-01", "2020-04-01"),
    c("2020-12-15", "2021-01-07")
  ),
  MMR = list( # Myanmar (Burma)
    c("2020-08-10", "2020-08-28"),
    c("2020-09-01", "2020-10-01")
  ),
  KOR = list( # South Korea
    c("2020-02-10", "2020-03-05"),
    c("2020-08-03", "2020-08-26"),
    c("2020-11-05", "2020-12-05")
  ),
  AFG = list( # Afghanistan
    c("2020-03-15", "2020-04-05"),
    c("2020-04-08", "2020-06-05"),
    c("2020-09-25", "2020-10-25")
  ),
  IRQ = list( # Iraq
    c("2020-02-20", "2020-04-01"),
    c("2020-05-15", "2020-06-15"),
    c("2020-07-15", "2020-08-20"),
    c("2021-02-01", "2021-02-22"),
    c("2021-02-25", "2021-04-01")
  ) ,
  UZB = list( # Uzbekistan
    c("2020-03-12", "2020-04-15"),
    c("2020-05-25", "2020-07-20"),
    c("2020-09-01", "2020-09-20"),
    c("2021-02-26", "2021-04-01")
  ),
  MYS = list( # Malaysia
    c("2020-02-25", "2020-03-28"),
    c("2020-09-01", "2020-10-15"),
    c("2020-10-16", "2020-12-22"),
    c("2020-12-25", "2021-02-01")
  ),
  NPL = list( # Nepal
    c("2020-05-01", "2020-06-10"),
    c("2020-07-15", "2020-09-01"),
    c("2020-09-25", "2020-10-20")
  ),
  SAU = list( # Saudi Arabia
    c("2020-03-01", "2020-03-30"),
    c("2020-04-01", "2020-04-28"),
    c("2020-05-28", "2020-06-18"),
    c("2021-01-05", "2021-02-10")
  )
)
l <- l[sort(names(l))]
se <- matrix(unlist(l), ncol = 2L, byrow = TRUE, dimnames = list(NULL, c("start", "end")))
se <- as.data.frame(se, stringsAsFactors = FALSE)
se[] <- lapply(se, as.Date)
country_iso3 <- rep.int(gl(length(l), 1L, labels = names(l)), lengths(l))
f <- function(x) x[do.call(order, x), , drop = FALSE]
se <- unsplit(by(se, country_iso3, f, simplify = FALSE), country_iso3)
wave <- factor(unsplit(lapply(l, seq_along), country_iso3))

load("worldstats.RData")
worldstats <- worldstats[match(country_iso3, worldstats$country_iso3, 0L), , drop = FALSE]
endpoints <- data.frame(
  se,
  country_iso3,
  wave,
  worldstats[c("country_name", "region", "continent",
               "population", "latitude", "longitude")],
  row.names = NULL
)
save(endpoints, file = "endpoints.RData")

# do_plot_ <- function(formula, data, spar = NULL, endpoints = NULL, ...) {
#   op <- par(mar = c(2, 3, 1, 1), mgp = c(2, 0.7, 0), las = 1)
#   on.exit(par(op))
#   xat <- seq(as.Date("2020-01-01"), Sys.Date(), by = "1 month")
#   plot(formula, data = data, xlab = "", xaxt = "n", ...)
#   abline(v = xat, lty = 3, col = "grey80")
#   axis(side = 1, at = xat, labels = months(xat, TRUE), gap.axis = 0)
#   if (!is.null(spar)) {
#     rhs <- eval(formula[[3L]], envir = data, enclos = parent.frame())
#     lhs <- eval(formula[[2L]], envir = data, enclos = parent.frame())
#     dd <- data.frame(x = rhs - rhs[1], y = lhs)[is.finite(lhs), , drop = FALSE]
#     ss <- smooth.spline(x = dd$x, y = dd$y, spar = spar)
#     lines(y ~ I(rhs[1] + x), data = ss[c("x", "y")], lwd = 2, col = "red")
#   }
#   if (!is.null(endpoints)) {
#     abline(v = as.Date(unlist(endpoints)), lty = 3)
#   }
#   invisible(NULL)
# }
# do_plot <- function(country_iso3, spar = NULL, endpoints = NULL, ...) {
#   do_plot_(log1p(cases) ~ date,
#     data = world_split[[country_iso3]],
#     spar = spar,
#     endpoints = endpoints,
#     ...
#   )
# }



