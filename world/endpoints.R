l <- list(
  Russia = list(
    c("2020-03-05", "2020-05-10"),
    c("2020-09-22", "2020-10-10"),
    c("2020-10-11", "2020-12-10")
  ),
  Germany = list(
    c("2020-02-25", "2020-04-05"),
    c("2020-07-10", "2020-08-23"),
    c("2020-10-01", "2020-11-10")
  ),
  France = list(
    c("2020-02-25", "2020-04-05"),
    c("2020-07-01", "2020-09-27"),
    c("2020-10-01", "2020-11-10"),
    c("2020-11-28", "2021-01-01")
  ),
  `United Kingdom` = list(
    c("2020-02-20", "2020-04-10"),
    c("2020-07-05", "2020-08-28"),
    c("2020-08-31", "2020-10-25"),
    c("2020-12-05", "2021-01-10")
  ),
  Italy = list(
    c("2020-02-23", "2020-03-25"),
    c("2020-08-12", "2020-09-05"),
    c("2020-09-28", "2020-11-15")
  ),
  Spain = list(
    c("2020-02-25", "2020-04-01"),
    c("2020-06-26", "2020-08-10"),
    c("2020-10-10", "2020-11-07"),
    c("2020-12-27", "2021-01-25")
  ),
  Ukraine = list(
    c("2020-03-15", "2020-04-28"),
    c("2020-05-24", "2020-06-29"),
    c("2020-07-15", "2020-08-24"),
    c("2020-08-25", "2020-12-01"),
    c("2021-02-10", "2021-03-25")
  ),
  Poland = list(
    c("2020-03-01", "2020-04-10"),
    c("2020-07-13", "2020-08-13"),
    c("2020-09-06", "2020-11-10"),
    c("2021-02-10", "2021-03-25")
  ),
  Romania = list(
    c("2020-03-05", "2020-04-13"),
    c("2020-06-05", "2020-06-25"),
    c("2020-07-01", "2020-08-01"),
    c("2020-09-15", "2020-11-13"),
    c("2021-02-15", "2021-03-25")
  ),
  Netherlands = list(
    c("2020-02-25", "2020-04-01"),
    c("2020-07-06", "2020-08-15"),
    c("2020-08-28", "2020-11-01"),
    c("2020-11-30", "2020-12-23")
  ),
  Belgium = list(
    c("2020-03-01", "2020-04-06"),
    c("2020-07-01", "2020-08-12"),
    c("2020-09-01", "2020-09-28"),
    c("2020-09-29", "2020-11-01")
  ),
  Greece = list(
    c("2020-02-25", "2020-04-03"),
    c("2020-07-20", "2020-08-18"),
    c("2020-10-10", "2020-11-15"),
    c("2021-01-18", "2021-02-20")
  ),
  `Czech Republic` = list(
    c("2020-03-01", "2020-04-03"),
    c("2020-08-25", "2020-09-25"),
    c("2020-09-28", "2020-10-30"),
    c("2020-12-01", "2021-01-10")
  ),
  Sweden = list(
    c("2020-02-25", "2020-03-15"),
    c("2020-03-16", "2020-04-12"),
    c("2020-05-25", "2020-06-20"),
    c("2020-08-31", "2020-10-15"),
    c("2020-10-16", "2020-11-15"),
    c("2020-11-16", "2021-01-08"),
    c("2021-02-01", "2021-03-25")
  ),
  Portugal = list(
    c("2020-03-01", "2020-04-03"),
    c("2020-05-05", "2020-06-12"),
    c("2020-08-20", "2020-09-20"),
    c("2020-10-01", "2020-11-19"),
    c("2020-12-24", "2021-01-30")
  ),
  Hungary = list(
    c("2020-03-01", "2020-04-15"),
    c("2020-06-15", "2020-08-18"),
    c("2020-08-20", "2020-09-22"),
    c("2020-10-12", "2020-11-18"),
    c("2021-02-15", "2021-03-25")
  ),
  Belarus = list(
    c("2020-04-01", "2020-05-01"),
    c("2020-08-13", "2020-08-28"),
    c("2020-09-15", "2020-11-01")
  ),
  Austria = list(
    c("2020-02-20", "2020-03-28"),
    c("2020-06-15", "2020-07-20"),
    c("2020-08-01", "2020-08-23"),
    c("2020-09-01", "2020-09-23"),
    c("2020-10-12", "2020-11-14"),
    c("2021-02-10", "2021-03-25")
  ),
  Switzerland = list(
    c("2020-02-20", "2020-03-28"),
    c("2020-06-15", "2020-07-10"),
    c("2020-07-12", "2020-09-18"),
    c("2020-09-25", "2020-11-06"),
    c("2021-02-20", "2021-03-25")
  ),
  Bulgaria = list(
    c("2020-03-01", "2020-04-01"),
    c("2020-04-10", "2020-04-28"),
    c("2020-05-25", "2020-06-15"),
    c("2020-06-16", "2020-07-23"),
    c("2020-09-20", "2020-11-15"),
    c("2021-01-17", "2021-03-25")
  ),
  Serbia = list(
    c("2020-03-10", "2020-04-17"),
    c("2020-06-15", "2020-07-10"),
    c("2020-10-15", "2020-12-01"),
    c("2021-02-13", "2021-03-05")
  ),
  Denmark = list(
    c("2020-03-01", "2020-04-05"),
    c("2020-07-07", "2020-08-15"),
    c("2020-08-25", "2020-09-27"),
    c("2020-10-17", "2020-11-07"),
    c("2020-11-27", "2020-12-20"),
    c("2021-02-10", "2021-03-25")
  ),
  Finland = list(
    c("2020-03-01", "2020-04-10"),
    c("2020-07-10", "2020-10-18"),
    c("2021-01-12", "2021-02-05")
  ),
  Slovakia = list(
    c("2020-03-01", "2020-04-01"),
    c("2020-06-01", "2020-07-05"),
    c("2020-07-08", "2020-09-12"),
    c("2020-09-15", "2020-11-01")
  ),
  Norway = list(
    c("2020-02-25", "2020-03-30"),
    c("2020-07-16", "2020-08-13"),
    c("2020-08-25", "2020-09-11"),
    c("2020-10-18", "2020-11-12"),
    c("2021-02-20", "2021-03-25")
  ),
  Ireland = list(
    c("2020-03-01", "2020-04-15"),
    c("2020-07-01", "2020-10-20"),
    c("2020-12-10", "2021-01-01")
  ),
  Croatia = list(
    c("2020-03-05", "2020-04-02"),
    c("2020-06-08", "2020-07-05"),
    c("2020-08-03", "2020-08-30"),
    c("2020-10-01", "2020-10-30"),
    c("2020-11-01", "2020-12-12"),
    c("2021-02-12", "2021-03-15")
  ),
  `Bosnia and Herzegovina` = list(
    c("2020-03-01", "2020-04-05"),
    c("2020-05-25", "2020-07-15"),
    c("2020-10-01", "2020-11-02"),
    c("2021-02-10", "2021-03-25")
  ),
  Albania = list(
    c("2020-03-05", "2020-04-05"),
    c("2020-05-20", "2020-06-15"),
    c("2020-06-16", "2020-08-25"),
    c("2020-10-01", "2020-11-20"),
    c("2020-12-25", "2021-02-12")
  ),
  Lithuania = list(
    c("2020-03-10", "2020-04-05"),
    c("2020-06-20", "2020-08-20"),
    c("2020-09-01", "2020-10-01"),
    c("2020-10-05", "2020-11-08"),
    c("2020-11-10", "2021-01-02")
  ),
  # Moldova = list(
  #   c("2020-03-01", "2020-04-10"),
  #   c("2020-04-15", "2020-12-10"),
  #   c("2021-01-15", "2021-03-05")
  # ),
  Slovenia = list(
    c("2020-03-01", "2020-03-28"),
    c("2020-06-01", "2020-07-05"),
    c("2020-08-01", "2020-09-30"),
    c("2020-10-01", "2020-11-01")
  ),
  Latvia = list(
    c("2020-03-01", "2020-04-01"),
    c("2020-09-15", "2020-10-15")
  ),
  Estonia = list(
    c("2020-02-25", "2020-04-05"),
    c("2020-07-10", "2020-10-02"),
    c("2020-10-12", "2020-11-15"),
    c("2020-11-16", "2020-12-25"),
    c("2021-02-01", "2021-03-12")
  ),
  Luxembourg = list(
    c("2020-03-01", "2020-03-30"),
    c("2020-06-18", "2020-07-25"),
    c("2020-10-12", "2020-11-05")
  ),
  Malta = list(
    c("2020-03-01", "2020-04-03"),
    c("2020-07-15", "2020-08-20"),
    c("2020-09-25", "2020-10-22"),
    c("2020-12-22", "2021-01-12"),
    c("2021-02-05", "2021-03-12")
  ),
  Iceland = list(
    c("2020-02-25", "2020-03-30"),
    c("2020-07-15", "2020-08-10"),
    c("2020-09-08", "2020-10-10")
  ),
  Andorra = list(
    c("2020-03-01", "2020-04-01"),
    c("2020-07-15", "2020-10-18"),
    c("2020-12-18", "2021-01-18")
  ),
  Monaco = list(
    c("2020-02-25", "2020-04-10"),
    c("2020-11-20", "2021-01-28")
  ),
  Liechtenstein = list(
    c("2020-09-15", "2020-11-15")
  ),
  `San Marino` = list(
    c("2020-02-25", "2020-04-15"),
    c("2020-09-20", "2020-11-18")
  ),
  `United States` = list(
    c("2020-03-01", "2020-04-04"),
    c("2020-06-10", "2020-07-15"),
    c("2020-10-15", "2020-11-20")
  ),
  Mexico = list(
    c("2020-03-10", "2020-04-10"),
    c("2020-11-15", "2020-12-01"),
    c("2021-01-01", "2021-01-23")
  ),
  Canada = list(
    c("2020-03-01", "2020-04-10"),
    c("2020-08-15", "2020-10-07"),
    c("2020-10-08", "2020-12-10")
  ),
  Guatemala = list(
    c("2020-03-10", "2020-05-30"),
    c("2020-06-01", "2020-07-10")
  ),
  Cuba = list(
    c("2020-03-10", "2020-04-15"),
    c("2020-07-20", "2020-08-15"),
    c("2020-10-10", "2020-11-01"),
    c("2020-11-20", "2021-02-05")
  ),
  Haiti = list(
    c("2020-04-25", "2020-06-10"),
    c("2020-11-25", "2021-01-25")
  ),
  `Dominican Republic` = list(
    c("2020-03-01", "2020-04-15"),
    c("2020-06-01", "2020-07-30"),
    c("2020-11-01", "2021-01-20")
  ),
  Honduras = list(
    c("2020-03-05", "2020-07-05")
  ),
  Nicaragua = list(
    c("2020-04-20", "2020-07-01")
  ),
  `El Salvador` = list(
    c("2020-03-15", "2020-05-25"),
    c("2020-06-05", "2020-07-10"),
    c("2020-09-15", "2020-12-01")
  ),
  `Costa Rica` = list(
    c("2020-03-01", "2020-04-01"),
    c("2020-05-20", "2020-07-20"),
    c("2020-07-21", "2020-09-18")
  ),
  Panama = list(
    c("2020-03-01", "2020-04-15"),
    c("2020-05-15", "2020-06-10"),
    c("2020-11-01", "2021-01-08")
  ),
  Jamaica = list(
    c("2020-03-01", "2020-05-01"),
    c("2020-07-15", "2020-09-20"),
    c("2021-01-05", "2021-03-25")
  ),
  Belize = list(
    c("2020-07-15", "2020-09-10"),
    c("2020-11-17", "2020-12-14")
  ),
  Bahamas = list(
    c("2020-03-10", "2020-04-15"),
    c("2020-07-01", "2020-08-05"),
    c("2020-08-06", "2020-10-15")
  ),
  Barbados = list(
    c("2020-12-01", "2021-02-25")
  ),
  Brazil = list(
    c("2020-02-25", "2020-04-15"),
    c("2020-11-01", "2020-12-05"),
    c("2021-02-12", "2021-03-25")
  ),
  Colombia = list(
    c("2020-03-01", "2020-04-10"),
    c("2020-12-10", "2021-01-20"),
    c("2021-03-07", "2021-03-25")
  ),
  Argentina = list(
    c("2020-03-01", "2020-04-10"),
    c("2020-05-01", "2020-07-01"),
    c("2020-09-01", "2020-10-25"),
    c("2020-12-18", "2021-01-10")
  ),
  Peru = list(
    c("2020-03-01", "2020-05-10"),
    c("2020-07-15", "2020-08-20"),
    c("2020-12-25", "2021-02-05")
  ),
  Venezuela = list(
    c("2020-05-01", "2020-06-10"),
    c("2020-06-27", "2020-08-18"),
    c("2021-01-01", "2021-01-21"),
    c("2021-03-01", "2021-03-25")
  ),
  Chile = list(
    c("2020-03-01", "2020-04-10"),
    c("2020-04-15", "2020-06-10"),
    c("2020-12-10", "2021-01-20"),
    c("2021-02-15", "2021-03-25")
  ),
  Ecuador = list(
    c("2020-03-01", "2020-04-10"),
    c("2020-05-25", "2020-07-20"),
    c("2020-12-20", "2021-02-01")
  ),
  Bolivia = list(
    c("2020-03-05", "2020-06-01"),
    c("2020-12-01", "2021-01-20")
  ),
  Paraguay = list(
    c("2020-06-01", "2020-09-10"),
    c("2020-11-01", "2020-12-10"),
    c("2021-02-01", "2021-03-25")
  ),
  Uruguay = list(
    c("2020-06-08", "2020-07-28"),
    c("2020-09-15", "2020-11-15"),
    c("2020-11-18", "2020-12-28"),
    c("2021-03-01", "2021-03-25")
  ),
  Guyana = list(
    c("2020-07-10", "2020-09-20"),
    c("2020-12-28", "2021-02-01"),
    c("2021-02-25", "2021-03-25")
  ),
  Suriname = list(
    c("2020-06-01", "2020-08-18"),
    c("2020-11-25", "2021-01-15")
  ),
  Australia = list(
    c("2020-03-01", "2020-03-30"),
    c("2020-06-12", "2020-07-20"),
    c("2020-12-08", "2020-12-31"),
    c("2021-02-18", "2021-03-15")
  ),
  `Papua New Guinea` = list(
    c("2020-07-12", "2020-08-18"),
    c("2021-01-15", "2021-03-25")
  ),
  `New Zealand` = list(
    c("2020-03-10", "2020-04-05"),
    c("2020-08-01", "2020-08-25")
  )
)
se <- c("start", "end")
endpoints <- data.frame(
  ts = rep(gl(length(l), 1L, labels = names(l)), lengths(l)),
  matrix(unlist(l), ncol = 2L, byrow = TRUE, dimnames = list(NULL, se)),
  stringsAsFactors = FALSE
)
endpoints[se] <- lapply(endpoints[se], as.Date)
save(endpoints, file = "endpoints.RData")

# do_plot_ <- function(formula, data, spar = NULL, endpoints = NULL, ...) {
#   op <- par(mar = c(2, 3, 1, 1), mgp = c(2, 0.7, 0), las = 1)
#   on.exit(par(op))
#   xat <- seq(as.Date("2020-01-01"), Sys.Date(), by = "1 month")
#   plot(formula, data = data, xlab = "", xaxt = "n", ...)
#   abline(v = xat, lty = 3, col = "grey80")
#   axis(side = 1, at = xat, labels = months(xat, TRUE), gap.axis = 0)
#   if (!is.null(spar)) {
#     rhs <- eval(formula[[3L]], envir = data, enclos = parent.frame())
#     lhs <- eval(formula[[2L]], envir = data, enclos = parent.frame())
#     dd <- data.frame(x = rhs - rhs[1], y = lhs)[is.finite(lhs), , drop = FALSE]
#     ss <- smooth.spline(x = dd$x, y = dd$y, spar = spar)
#     lines(y ~ I(rhs[1] + x), data = ss[c("x", "y")], lwd = 2, col = "red")
#   }
#   if (!is.null(endpoints)) {
#     abline(v = as.Date(unlist(endpoints)), lty = 3)
#   }
#   invisible(NULL)
# }
# do_plot <- function(country, spar = NULL, endpoints = NULL, ...) {
#   do_plot_(log1p(cases) ~ date,
#            data = world_split[[country]],
#            spar = spar,
#            endpoints = endpoints,
#            ...
#   )
# }
